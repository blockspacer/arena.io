option optimize_for = SPEED;

import "ProtoFiles/common.proto";
import "ProtoFiles/profile.proto";

package proto_game;

/* DATA TYPES */

enum Weapons
{
  None = 0;
  Starting = 1;
  
  Canon = 2;
  Sniper = 3;
  MachineGun = 4;
  Flank = 5;
  
  Triple = 6;
  TwinFlank = 7;
  Quad = 8;
  Triangle = 9;
}

enum PowerUpType
{
  DoubleDamage = 0;
  Invisibility = 1;
  HugeBullets = 2;
  Regeneration = 3;
}

enum Stats
{
  MaxHealth = 1;
  HealthRegen = 2;
  BulletDamage = 3;
  SkillDamage = 4;
  MovementSpeed = 5;
  ReloadSpeed = 6;
  Armor = 7;
  BulletSpeed = 8;
  
  SkillCooldown = 9;
  BulletSize = 10;
}

message StatValue
{
  required Stats stat = 1;
  required float value = 2;
  required float step = 3;
}

enum ExpBlocks
{
  Small = 0;
  Medium = 1;
  Big = 2;
  Huge = 3;
  GoldBlock = 4;
}

message Vector 
{
  required float x = 1;
  required float y = 2;
}

/* REQUESTS */

message Ping 
{
  message Request 
	{
    required int64 timestamp = 1;
    
    extend proto_common.Request 
		{
			optional proto_game.Ping.Request ping_req = 12;
		}
  }
  
  message Response 
  {
    required int64 timestamp = 1;
    
    extend proto_common.Response 
		{
			optional proto_game.Ping.Response ping_req = 12;
		}
  }
}

message PlayerMove 
{
  message Request 
	{
    required Vector position = 1;
    required int64 timestamp = 2;
    required bool stop = 3;
  
    extend proto_common.Request 
		{
			optional proto_game.PlayerMove.Request plr_move_req = 2005;
		}
  }
}

message FindRoom
{
  message Request 
  {
    extend proto_common.Request
    {
      optional proto_game.FindRoom.Request fnd_room_req = 2013;
    }
  }
  
  message Response 
  {
    extend proto_common.Response
    {
      optional proto_game.FindRoom.Response fnd_room_res = 2013;
    }
  }
}

message JoinGame
{
  message Request
  {
    required proto_profile.PlayerClasses class = 1;
  
    extend proto_common.Request
    {
      optional proto_game.JoinGame.Request join_game_req = 2011;
    }
  }
  
  message Response
  {
    required int32 time_left = 1;
    repeated float outer_border = 2;
  
    extend proto_common.Response
    {
      optional proto_game.JoinGame.Response join_game_res = 2011;
    }
  }
}

message StatUpgrade
{
  message Request
  {
    required Stats stat = 1;
  
    extend proto_common.Request 
    {
      optional proto_game.StatUpgrade.Request plr_stat_upg_req = 2014;
    }
  }
  
  message Response 
  {
    extend proto_common.Response 
    {
      optional proto_game.StatUpgrade.Response plr_stat_upg_res = 2014;
    }
  }
}

message PlayerUpgrade
{
  required int32 guid = 1;
  
  extend proto_common.Request 
	{
	  optional proto_game.PlayerUpgrade plr_upg_req = 2010;
	}
  
  extend proto_common.Event 
	{
	  optional proto_game.PlayerUpgrade plr_upg_evt = 2010;
	}
}

message ApplyDamage
{
  required int32 target = 1;
  required float damage = 2;
  required int32 lifetime = 3;
  
  extend proto_common.Request
  {
    optional proto_game.ApplyDamage dmg_req = 2004; 
  }
}

message GrabPowerUp
{
  message Request
  {
    required int32 powerUp = 1;
    
    extend proto_common.Request
    {
      optional proto_game.GrabPowerUp.Request grb_pwr_req = 2015; 
    }
  }
  
  message Response
  {
    extend proto_common.Response
    {
      optional proto_game.GrabPowerUp.Response grb_pwr_res = 2015; 
    }
  }
}

message GrabGoldCoin
{
  message Request
  {
    required int32 goldCoin = 1;
    
    extend proto_common.Request
    {
      optional proto_game.GrabGoldCoin.Request grb_gold_req = 2016; 
    }
  }
  
  message Response
  {
    extend proto_common.Response
    {
      optional proto_game.GrabGoldCoin.Response grb_gold_res = 2016; 
    }
  }
}

/*  EVENTS */ 

message PowerUpAppeared
{
  required PowerUpType type = 1;
  required float x = 2;
  required float y = 3;
  required int32 id = 4;
  required int32 lifetime = 5;
  
  extend proto_common.Event
  {
    optional proto_game.PowerUpAppeared pwrup_app_evt = 2016;
  }
}

message PowerUpGrabbed
{
  required int32 id = 1;
  required int32 who_grabbed = 2;
  
  extend proto_common.Event
  {
    optional proto_game.PowerUpGrabbed pwrup_grb_evt = 2017;
  }
}

message PlayerStats
{
  repeated StatValue stats = 1;
}

message BlockAppeared
{
	required int32 guid = 1;
  required Vector position = 2;
  required float hp = 3;
  required ExpBlocks type = 4;
  required float max_hp = 5;

	extend proto_common.Event 
	{
	  optional proto_game.BlockAppeared block_appeared_evt = 2001;
	}
}

message UnitDie
{
  required int32 guid = 1;
  
  extend proto_common.Event 
  {
    optional proto_game.UnitDie unit_die_evt = 2003;
  }
}

message SpawnGoldCoin
{
  required float x = 1;
  required float y = 2;
  required int32 value = 3;
  
  extend proto_common.Event 
  {
    optional proto_game.SpawnGoldCoin gold_coin_evt = 2018;
  }
}

message UnitMove
{
  required int32 guid = 1;
  required float x = 2;
  required float y = 3;
  required int64 timestamp = 4;
  required bool stop = 5;
  
  extend proto_common.Event 
	{
	  optional proto_game.UnitMove move_evt = 2004;
	}
}

message PlayerTurn
{
  required float angle = 1;
  optional int32 guid = 2;
  
  extend proto_common.Event 
	{
	  optional proto_game.PlayerTurn turn_evt = 2009;
	}
  
  extend proto_common.Request 
	{
	  optional proto_game.PlayerTurn turn_req = 2009;
	}
}

message PlayerExperience
{
  required int32 exp = 1;
  
  extend proto_common.Event 
	{
	  optional proto_game.PlayerExperience plr_exp_evt = 2012;
	}
}

message PlayerLevelUp
{
  required int32 lvl = 1;
  required int32 expLeft = 2;
  
  extend proto_common.Event 
	{
	  optional proto_game.PlayerLevelUp plr_lvl_up_evt = 2013;
	}
}

message PlayerStatusChange
{
  required int32 guid = 1;
  optional float hp = 2;
  
  extend proto_common.Event 
	{
	  optional proto_game.PlayerStatusChange plr_status_evt = 2011;
	}
}

message UnitAttack
{
  required int32 guid = 1;
  required float direction = 2;
  required float x = 3;
  required float y = 4;
  
  extend proto_common.Event 
	{
	  optional proto_game.UnitAttack unit_att_evt = 2006;
	}
  
  extend proto_common.Request 
	{
	  optional proto_game.UnitAttack unit_att_req = 2006;
	}
}

message PlayerAppeared
{
	required string name = 1;
  required Vector position = 2;
  required int32 guid = 3;
  required PlayerStats stats = 4;
  required float hp = 5;
  required bool local = 6;
  required proto_profile.PlayerClasses class = 7;

	extend proto_common.Event 
	{
	  optional proto_game.PlayerAppeared player_appeared_evt = 2005;
	}
}

message PlayerDisconnected
{
  required int32 who = 1;
  
  extend proto_common.Event
  {
    optional proto_game.PlayerDisconnected plr_disc_evt = 2007; 
  }
}

message ScoreChanged
{
  required int32 guid = 1;
  required int32 score = 2;
  
  extend proto_common.Event
  {
    optional proto_game.ScoreChanged plr_score_evt = 2014; 
  }
}

message GameFinished
{
  required int32 exp = 1;
  required int32 coins = 2;
  
  extend proto_common.Event
  {
    optional proto_game.GameFinished game_finished_evt = 2015;
  }
}

message DamageDone
{
  required int32 target = 1;
  required float hp_left = 2;
  
  extend proto_common.Event
  {
    optional proto_game.DamageDone dmg_done_evt = 2008; 
  }
}